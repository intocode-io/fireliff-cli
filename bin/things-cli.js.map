{"version":3,"sources":["../lib/things-cli.js"],"names":["versionText","pjson","version","help","commandLineArgs","require","commandLineUsage","operation","_unknown","name","defaultOption","stopAtFirstUnknown","argv","options","alias","type","String","Boolean","things","Things","test","console","log","getUsage","createUsage","deleteUsage","thingsUsage","process","exit","indexOf","liff","product","error","prompt","warn","EOL","input","user","device","then","validateConfig","createTrialProduct","result","deleteTrialProduct","getDevicesByProductUser","getDeviceByDeviceUser","getProduct","getTrialProducts","catch","debug","response","message","toString","commandError"],"mappings":"AAAA;;;AACA;;AACA;;AACA;;AACA;;AAKA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,WAAW,GAAI,gBAAeC,iBAAMC,OAAQ,oBAA9B,CAAkDC,IAAtE;;AAEA,IAAI;AACF,QAAMC,eAAe,GAAGC,OAAO,CAAC,mBAAD,CAA/B;;AACA,QAAMC,gBAAgB,GAAGD,OAAO,CAAC,oBAAD,CAAhC;;AAEA,QAAM;AAAEE,IAAAA,SAAF;AAAaC,IAAAA;AAAb,MAA0BJ,eAAe,CAC7C,CAAC;AAAEK,IAAAA,IAAI,EAAE,WAAR;AAAqBC,IAAAA,aAAa,EAAE;AAApC,GAAD,CAD6C,EAE7C;AAAEC,IAAAA,kBAAkB,EAAE;AAAtB,GAF6C,CAA/C;AAIA,QAAMC,IAAI,GAAGJ,QAAQ,IAAI,EAAzB;AACA,QAAMK,OAAO,GAAGT,eAAe,CAC7B,CACE;AAAEK,IAAAA,IAAI,EAAE,QAAR;AAAkBK,IAAAA,KAAK,EAAE,GAAzB;AAA8BC,IAAAA,IAAI,EAAEC;AAApC,GADF,EAEE;AAAEP,IAAAA,IAAI,EAAE,MAAR;AAAgBK,IAAAA,KAAK,EAAE,GAAvB;AAA4BC,IAAAA,IAAI,EAAEE;AAAlC,GAFF,EAGE;AAAER,IAAAA,IAAI,EAAE,IAAR;AAAcM,IAAAA,IAAI,EAAEC;AAApB,GAHF,EAIE;AAAEP,IAAAA,IAAI,EAAE,MAAR;AAAgBK,IAAAA,KAAK,EAAE,GAAvB;AAA4BC,IAAAA,IAAI,EAAEC;AAAlC,GAJF,EAKE;AAAEP,IAAAA,IAAI,EAAE,MAAR;AAAgBK,IAAAA,KAAK,EAAE,GAAvB;AAA4BC,IAAAA,IAAI,EAAEC;AAAlC,GALF,EAME;AAAEP,IAAAA,IAAI,EAAE,SAAR;AAAmBK,IAAAA,KAAK,EAAE,GAA1B;AAA+BC,IAAAA,IAAI,EAAEC;AAArC,GANF,EAOE;AAAEP,IAAAA,IAAI,EAAE,MAAR;AAAgBK,IAAAA,KAAK,EAAE,GAAvB;AAA4BC,IAAAA,IAAI,EAAEC;AAAlC,GAPF,EAQE;AAAEP,IAAAA,IAAI,EAAE,SAAR;AAAmBK,IAAAA,KAAK,EAAE,GAA1B;AAA+BC,IAAAA,IAAI,EAAEE;AAArC,GARF,EASE;AAAER,IAAAA,IAAI,EAAE,OAAR;AAAiBM,IAAAA,IAAI,EAAEE;AAAvB,GATF,CAD6B,EAY7B;AAAEL,IAAAA;AAAF,GAZ6B,CAA/B;AAeA,QAAMM,MAAM,GAAG,IAAIC,cAAJ,EAAf;;AAEA,MAAIN,OAAO,CAACV,IAAZ,EAAkB;AAChB,QAAI,OAAOiB,IAAP,CAAYb,SAAZ,CAAJ,EAA4B;AAC1Bc,MAAAA,OAAO,CAACC,GAAR,CAAYhB,gBAAgB,CAACiB,wBAAD,CAA5B;AACD,KAFD,MAEO,IAAI,UAAUH,IAAV,CAAeb,SAAf,KAA6B,OAAOa,IAAP,CAAYb,SAAZ,CAAjC,EAAyD;AAC9Dc,MAAAA,OAAO,CAACC,GAAR,CAAYhB,gBAAgB,CAACkB,2BAAD,CAA5B;AACD,KAFM,MAEA,IACL,UAAUJ,IAAV,CAAeb,SAAf,KACA,UAAUa,IAAV,CAAeb,SAAf,CADA,IAEA,MAAMa,IAAN,CAAWb,SAAX,CAHK,EAIL;AACAc,MAAAA,OAAO,CAACC,GAAR,CAAYhB,gBAAgB,CAACmB,2BAAD,CAA5B;AACD,KANM,MAMA;AACLJ,MAAAA,OAAO,CAACC,GAAR,CAAYhB,gBAAgB,CAACoB,uBAAD,CAA5B;AACD;;AACDC,IAAAA,OAAO,CAACC,IAAR,CAAa,CAAb;AACD;;AAED,MACE,CACE,cADF,EAEE,cAFF,EAGE,YAHF,EAIE,aAJF,EAKE,WALF,EAMEC,OANF,CAMUtB,SANV,IAMuB,CAAC,CAP1B,EAQE;AACA,YAAQA,SAAR;AACE,WAAK,cAAL;AACE,YAAI,CAACM,OAAO,CAACiB,IAAT,IAAiB,CAACjB,OAAO,CAACkB,OAA9B,EAAuC;AACrCV,UAAAA,OAAO,CAACW,KAAR,CACG,WACC,sBAAsBC,MACvB,oCAFD,CAEqCC,IAFrC,GAGEC,OAHF,GAIG,0BAAyB,kBAAkBC,KAAM,QAChD,0BAA0BA,KAC3B,EAFD,CAEGjC,IAPP;AASAwB,UAAAA,OAAO,CAACC,IAAR,CAAa,CAAb;AACD;;AACD;;AAEF,WAAK,cAAL;AACE,YAAI,CAACf,OAAO,CAACkB,OAAb,EAAsB;AACpBV,UAAAA,OAAO,CAACW,KAAR,CACG,WAAU,sBAAsBC,MAAO,sBAAxC,CAA8DC,IAA9D,GACEC,OADF,GAEG,0BAAyB,wBAAwBC,KAAM,EAAxD,CAA0DjC,IAH9D;AAKAwB,UAAAA,OAAO,CAACC,IAAR,CAAa,CAAb;AACD;;AACD;;AAEF,WAAK,YAAL;AACE,YACG,CAACf,OAAO,CAACwB,IAAT,IAAiB,CAACxB,OAAO,CAACkB,OAA3B,IACC,CAAClB,OAAO,CAACwB,IAAT,IAAiB,CAACxB,OAAO,CAACyB,MAF7B,EAGE;AACAjB,UAAAA,OAAO,CAACW,KAAR,CACG,WACC,oBAAoBC,MACrB,gEAFD,CAGGC,IAHH,GAIEC,OAJF,GAKG,0BAAyB,kBAAkBC,KAAM,UAChD,wBAAwBA,KACzB,QAAO,sBAAsBA,KAAM,EAFpC,CAEsCjC,IAR1C;AAUAwB,UAAAA,OAAO,CAACC,IAAR,CAAa,CAAb;AACD;;AACD;;AAEF,WAAK,aAAL;AACE,YAAI,CAACf,OAAO,CAACyB,MAAb,EAAqB;AACnBjB,UAAAA,OAAO,CAACW,KAAR,CACG,WAAU,qBAAqBC,MAAO,4BAAvC,CACGC,IADH,GAEEC,OAFF,GAGG,0BAAyB,sBAAsBC,KAAM,EAAtD,CAAwDjC,IAJ5D;AAMAwB,UAAAA,OAAO,CAACC,IAAR,CAAa,CAAb;AACD;;AACD;AAxDJ;;AA2DA,6BACGW,IADH,CACQC,sBADR,EAEGD,IAFH,CAEQ,MAAM;AACV,cAAQhC,SAAR;AACE,aAAK,cAAL;AACE,iBAAOW,MAAM,CACVuB,kBADI,CACe5B,OAAO,CAACiB,IADvB,EAC6BjB,OAAO,CAACkB,OADrC,EAEJQ,IAFI,CAEEG,MAAD,IAAY;AAChBrB,YAAAA,OAAO,CAACC,GAAR,CAAYoB,MAAZ;AACA;AACD,WALI,CAAP;;AAOF,aAAK,cAAL;AACE,iBAAOxB,MAAM,CAACyB,kBAAP,CAA0B9B,OAAO,CAACkB,OAAlC,EAA2CQ,IAA3C,CAAiDG,MAAD,IAAY;AACjErB,YAAAA,OAAO,CAACC,GAAR,CAAYoB,MAAZ;AACA;AACD,WAHM,CAAP;;AAKF,aAAK,YAAL;AACE,cAAI7B,OAAO,CAACkB,OAAZ,EAAqB;AACnB,mBAAOb,MAAM,CACV0B,uBADI,CACoB/B,OAAO,CAACkB,OAD5B,EACqClB,OAAO,CAACwB,IAD7C,EAEJE,IAFI,CAEEG,MAAD,IAAY;AAChBrB,cAAAA,OAAO,CAACC,GAAR,CAAYoB,MAAZ;AACA;AACD,aALI,CAAP;AAMD,WAPD,MAOO;AACL,mBAAOxB,MAAM,CACV2B,qBADI,CACkBhC,OAAO,CAACyB,MAD1B,EACkCzB,OAAO,CAACwB,IAD1C,EAEJE,IAFI,CAEEG,MAAD,IAAY;AAChBrB,cAAAA,OAAO,CAACC,GAAR,CAAYoB,MAAZ;AACA;AACD,aALI,CAAP;AAMD;;AAEH,aAAK,aAAL;AACE,iBAAOxB,MAAM,CAAC4B,UAAP,CAAkBjC,OAAO,CAACyB,MAA1B,EAAkCC,IAAlC,CAAwCG,MAAD,IAAY;AACxDrB,YAAAA,OAAO,CAACC,GAAR,CAAYoB,MAAZ;AACA;AACD,WAHM,CAAP;;AAKF,aAAK,WAAL;AACE,iBAAOxB,MAAM,CAAC6B,gBAAP,GAA0BR,IAA1B,CAAgCG,MAAD,IAAY;AAChDrB,YAAAA,OAAO,CAACC,GAAR,CAAYoB,MAAZ;AACA;AACD,WAHM,CAAP;AAvCJ;;AA6CA;AACD,KAjDH,EAkDGM,KAlDH,CAkDUhB,KAAD,IAAW;AAChB,UAAInB,OAAO,CAACoC,KAAZ,EAAmB;AACjB5B,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBU,KAAK,CAACkB,QAA9B;AACD;;AAED7B,MAAAA,OAAO,CAACW,KAAR,CAAcA,KAAK,CAACmB,OAAN,IAAiBnB,KAAK,CAACoB,QAAN,EAA/B;AACAzB,MAAAA,OAAO,CAACC,IAAR,CAAa,CAAb;AACD,KAzDH;AA0DD,GA9HD,MA8HO,IAAIrB,SAAJ,EAAe;AACpB,YAAQA,SAAR;AACE,WAAK,SAAL;AACEc,QAAAA,OAAO,CAACC,GAAR,CAAYtB,WAAZ;AACA;;AACF,WAAK,MAAL;AACA;AACEqB,QAAAA,OAAO,CAACC,GAAR,CAAYhB,gBAAgB,CAACoB,uBAAD,CAA5B;AANJ;AAQD,GATM,MASA,IAAIb,OAAO,CAACX,OAAZ,EAAqB;AAC1BmB,IAAAA,OAAO,CAACC,GAAR,CAAYtB,WAAZ;AACD,GAFM,MAEA;AACLqB,IAAAA,OAAO,CAACC,GAAR,CAAYhB,gBAAgB,CAACoB,uBAAD,CAA5B;AACD;AACF,CAvLD,CAuLE,OAAO2B,YAAP,EAAqB;AACrB,mCAAoBA,YAApB;AACD","sourcesContent":["#!/usr/bin/env node\nimport 'console.table';\nimport { EOL } from 'os';\nimport './colors-set-theme';\nimport thingsUsage, {\n  createUsage,\n  deleteUsage,\n  getUsage,\n} from './things-cli-usage';\nimport { commandErrorHandler, getConfig, validateConfig } from './shared';\nimport { Things } from './things.js';\nimport pjson from '../package.json';\n\nconst versionText = `Things CLIs v${pjson.version} for Things API v1`.help;\n\ntry {\n  const commandLineArgs = require('command-line-args');\n  const commandLineUsage = require('command-line-usage');\n\n  const { operation, _unknown } = commandLineArgs(\n    [{ name: 'operation', defaultOption: true }],\n    { stopAtFirstUnknown: true }\n  );\n  const argv = _unknown || [];\n  const options = commandLineArgs(\n    [\n      { name: 'device', alias: 'd', type: String },\n      { name: 'help', alias: 'h', type: Boolean },\n      { name: 'id', type: String },\n      { name: 'liff', alias: 'l', type: String },\n      { name: 'name', alias: 'n', type: String },\n      { name: 'product', alias: 'p', type: String },\n      { name: 'user', alias: 'u', type: String },\n      { name: 'version', alias: 'v', type: Boolean },\n      { name: 'debug', type: Boolean },\n    ],\n    { argv }\n  );\n\n  const things = new Things();\n\n  if (options.help) {\n    if (/^get/.test(operation)) {\n      console.log(commandLineUsage(getUsage));\n    } else if (/^create/.test(operation) || /^add/.test(operation)) {\n      console.log(commandLineUsage(createUsage));\n    } else if (\n      /^delete/.test(operation) ||\n      /^remove/.test(operation) ||\n      /^rm/.test(operation)\n    ) {\n      console.log(commandLineUsage(deleteUsage));\n    } else {\n      console.log(commandLineUsage(thingsUsage));\n    }\n    process.exit(0);\n  }\n\n  if (\n    [\n      'create:trial',\n      'delete:trial',\n      'get:device',\n      'get:product',\n      'get:trial',\n    ].indexOf(operation) > -1\n  ) {\n    switch (operation) {\n      case 'create:trial':\n        if (!options.liff || !options.product) {\n          console.error(\n            `Command ${\n              'things create:trial'.prompt\n            } required LIFF ID and product name`.warn +\n              EOL +\n              `Try re-run with option ${'--liff <liffId>'.input} and ${\n                '--product <productName>'.input\n              }`.help\n          );\n          process.exit(1);\n        }\n        break;\n\n      case 'delete:trial':\n        if (!options.product) {\n          console.error(\n            `Command ${'things delete:trial'.prompt} required Product ID`.warn +\n              EOL +\n              `Try re-run with option ${'--product <productId>'.input}`.help\n          );\n          process.exit(1);\n        }\n        break;\n\n      case 'get:device':\n        if (\n          (!options.user && !options.product) ||\n          (!options.user && !options.device)\n        ) {\n          console.error(\n            `Command ${\n              'things get:device'.prompt\n            } required User ID together with either product ID or device ID`\n              .warn +\n              EOL +\n              `Try re-run with option ${'--user <userId>'.input}, and  ${\n                '--product <productId>'.input\n              } OR  ${'--device <deviceId>'.input}`.help\n          );\n          process.exit(1);\n        }\n        break;\n\n      case 'get:product':\n        if (!options.device) {\n          console.error(\n            `Command ${'things get:product'.prompt} required Device ID option`\n              .warn +\n              EOL +\n              `Try re-run with option ${'--device <deviceId>'.input}`.help\n          );\n          process.exit(1);\n        }\n        break;\n    }\n\n    getConfig()\n      .then(validateConfig)\n      .then(() => {\n        switch (operation) {\n          case 'create:trial':\n            return things\n              .createTrialProduct(options.liff, options.product)\n              .then((result) => {\n                console.log(result);\n                return;\n              });\n\n          case 'delete:trial':\n            return things.deleteTrialProduct(options.product).then((result) => {\n              console.log(result);\n              return;\n            });\n\n          case 'get:device':\n            if (options.product) {\n              return things\n                .getDevicesByProductUser(options.product, options.user)\n                .then((result) => {\n                  console.log(result);\n                  return;\n                });\n            } else {\n              return things\n                .getDeviceByDeviceUser(options.device, options.user)\n                .then((result) => {\n                  console.log(result);\n                  return;\n                });\n            }\n\n          case 'get:product':\n            return things.getProduct(options.device).then((result) => {\n              console.log(result);\n              return;\n            });\n\n          case 'get:trial':\n            return things.getTrialProducts().then((result) => {\n              console.log(result);\n              return;\n            });\n        }\n\n        return;\n      })\n      .catch((error) => {\n        if (options.debug) {\n          console.log('Response', error.response);\n        }\n\n        console.error(error.message || error.toString());\n        process.exit(1);\n      });\n  } else if (operation) {\n    switch (operation) {\n      case 'version':\n        console.log(versionText);\n        break;\n      case 'help':\n      default:\n        console.log(commandLineUsage(thingsUsage));\n    }\n  } else if (options.version) {\n    console.log(versionText);\n  } else {\n    console.log(commandLineUsage(thingsUsage));\n  }\n} catch (commandError) {\n  commandErrorHandler(commandError);\n}\n"],"file":"things-cli.js"}